---
title: "A general model for the evolution of nuptial gift-giving: Supporting Information"
author: |
  | Anders P. Charmouh$^{1,4, 5}$, Trine Bilde$^{2}$, Greta Bocedi$^{1}$, A. Bradley Duthie$^{3}$
date: '[1] School of Biological Sciences, University of Aberdeen, UK. [2] Department of Biology, Aarhus University, Denmark. [3] Biological and Environmental Sciences, University of Stirling, UK.  [4] Bioinformatics Research Centre Aarhus University, University City 81, building 1872, 3rd floor, DK-8000 Aarhus C, Denmark [5] Email: apc@birc.au.dk'
output:
  pdf_document:
    fig_caption: yes
    keep_tex: yes
  html_document: default
  word_document:
    fig_caption: yes
    pandoc_args:
    - --csl
    - evolution-letters.csl
    reference_docx: docx_template.docx
bibliography: nuptial_refs.bib
header-includes:
- \usepackage{amsmath}
- \usepackage{natbib}
- \usepackage{lineno}
- \usepackage{caption}
- \usepackage[utf8]{inputenc}
- \bibliographystyle{amnatnat}
linestretch: 1
link-citations: yes
linkcolor: blue
csl: evolution-letters.csl
biblio-style: apalike
---

```{r, echo = FALSE}
library("knitr")
calc_beta <- function(M = 1, TF = 1, TM = 1){
  term1 <-   (M * (TF - TM))^2;
  term2 <-   (M * (TF - TM))^4;
  term3 <- 4*(M * (TF - TM))^2;
  ttrm  <- (term2 + term3)^(1/2);
  sol1  <- 0.5 * (term1 - ttrm) + 1;
  sol2  <- 0.5 * (term1 + ttrm) + 1;
  if(TF > TM){
    beta = max(c(sol1, sol2));
  }else{
    beta = min(c(sol1, sol2));
  }
  return(list = c(beta = beta, solution1 = sol1, solution2 = sol2));
}
get_beta <- function(M = 1, TF = 1, TM = 1){
  betas <- rep(NA, length = length(TM));
  for(i in 1:length(TM)){
    betas[i] <- calc_beta(M = M, TF = TF, TM = TM[i])[[1]];
  }
  return(betas);
}
PrGf <- function(Tm, a1){
  vals <- 1 - exp(-(1/a1)*Tm);
  return(vals);
}
PrFf <- function(Tm, a1, a2 = Inf){
  vals <- (1 - exp(-(1/a2)*Tm)) * exp(-(1/a1)*Tm);
  return(vals);
}
dWdT <- function(gamma, Tm, beta = 1, M = 100, a1 = 1){
  num1 <- gamma * (M*M + ((M*M*Tm + M*sqrt(beta))/a1) );
  dem1 <- exp((1/a1)*Tm);
  num2 <- (num1 / dem1) - M*M*(1 + gamma);
  den2 <- ((Tm * M) + sqrt(beta))^2;
  val  <- num2/den2;
  return(val);
}
dWdT_check <- function(gamma, beta = 1, M = 100, a1 = 1){
  term1 <- (gamma * M) / (a1*sqrt(beta));
  term2 <- (M*M) / beta;
  val   <- term1 - term2;
  return(val);
}
recursive_b <- function(B, D, Tf, Tm, crit = 0.0001, maxit = 9999){
  conv <- 1;
  iter <- 0;
  while(conv > crit & iter < maxit){
    Fe   <- D * (B / (1 + B));
    Me   <- (1 + B) / D;
    Bn   <- (Me / (Tm + Me)) / (Fe / (Tf + Fe));
    iter <- iter + 1;
    conv <- abs(Bn - B);
    B    <- Bn;
  }
  return(list(B = B, conv = conv, iter = iter));
}
calc_beta <- function(M = 1, TF = 1, TM = 1){
  vals <- recursive_b(B = 1, D = M, Tf = TF, Tm = TM);
  beta <- vals$B
  sol1 <- vals$conv;
  sol2 <- vals$iter;
  return(list = c(beta = beta, solution1 = sol1, solution2 = sol2));
}
get_beta <- function(M = 1, TF = 1, TM = 1){
  betas <- rep(NA, length = length(TM));
  for(i in 1:length(TM)){
    betas[i] <- calc_beta(M = M, TF = TF, TM = TM[i])[[1]];
  }
  return(betas);
}
gamma_m <- function(R = 1, beta = 1, alpha = 1/16, TF = 2){
  return(alpha * (R / (beta + 1)));
}
gamma_f <- function(R = 1, beta = 1, alpha = 1/16, TF = 2){
  topp <- exp(alpha / alpha);
  bott <- TF * R * (beta / (beta + 1)) * (exp(alpha/alpha) - 1);
  return(topp/bott);
}
PrGf <- function(Tm, a1){
  vals <- 1 - exp(-(1/a1)*Tm);
  return(vals);
}

PrLf <- function(Tm, a1){
  vals <- exp(-(1/a1)*Tm);
  return(vals);
}

W_mf <- function(gamma, Tm, beta, M, lambda = 1, PrG, PrL){
  top <- lambda * (PrG * (1 + gamma) + PrL);
  bot <- Tm + (sqrt(beta) / M); 
  val <- top/bot;
  return(val);
}

W_mf_full  <- function(gamma, Tm, beta_val, M, a1, lambda = 1){
  PrG_val  <- PrGf(Tm = Tm, a1 = a1);
  PrL_val  <- PrLf(Tm = Tm, a1 = a1);
  W_mf_val <- W_mf(gamma = gamma, Tm = Tm, beta = beta_val, M = M,
                   PrG = PrG_val, PrL = PrL_val, lambda = lambda);
  return(W_mf_val);
}

W_m  <- function(mom = 1, mim = 1, mof = 1, mif = 1, M = 1, TF, TM, gamma, 
                 a1, bb){
  WW <- W_mf_full(gamma = gamma, Tm = TM, beta_val = bb, M = M, a1 = a1);
  return(WW)
}

Wp <- function(M, beta, Tm, a1, gamma, lambda){
  t1   <- (M*M + ((M*M*Tm + M * sqrt(beta))/a1))
  topp <- lambda * (((gamma * t1) / exp(Tm/a1)) - (M*M*(1 + gamma)))
  bott <- (Tm * M + sqrt(beta))^2
  val  <- topp / bott;
  return(val);
}

findWpmin <- function(M, beta, a1, gamma, b0, b1, lambda = 1){
  bynum   <- ((b1 + b0)/2 - b0) / 1000;
  TMvals1 <- seq(from = b0, to = (b1 + b0)/2, by = bynum);
  TMvals2 <- seq(from = (b1 + b0)/2, to = b1, by = bynum);
  abm     <- 10000;
  while(bynum > 0 & abm > 0.00001){
    ab1 <- abs(Wp(M = M, beta = beta, Tm = TMvals1, a1 = a1, gamma = gamma,
                  lambda = lambda));
    ab2 <- abs(Wp(M = M, beta = beta, Tm = TMvals2, a1 = a1, gamma = gamma,
                  lambda = lambda));
    mn1 <- min(ab1);
    mn2 <- min(ab2);
    abm <- min(c(mn1, mn2));
    if(mn1 < mn2){
      b1  <- (b1 + b0)/2;
    }else{
      b0  <- (b1 + b0)/2;
    }
    bynum   <- ((b1 + b0)/2 - b0) / 1000;
    TMvals1 <- seq(from = b0, to = (b1 + b0)/2, by = bynum);
    TMvals2 <- seq(from = (b1 + b0)/2, to = b1, by = bynum);
  }
  return((b1 + b0)/2);
}
female_IBM_criteria <- function(MGf, MLf, lambda = 1, TF = 2){
  MM   <- MGf + MLf;
  gamF <- lambda / (TF * (MM - MLf));
  return(gamF);
}

male_IBM_criteria <- function(Male_M, alpha = 1, lambda = 1){
  return(lambda * alpha * Male_M);
}

simpleboot <- function(freqs, repli = 1000, alpha = 0.05){  
  vals  <- NULL;                             
  i     <- 0;                                    
  while(i < repli){                             
    boot  <- sample(x = freqs, size = length(freqs), replace = TRUE);     
    strap <- mean(boot);                      
    vals  <- c(vals,strap);                     
    i     <- i + 1;                          
  }                                           
  vals   <- sort(x = vals, decreasing = FALSE);    
  lowCI  <- vals[round( (alpha * 0.5) * repli )];    
  highCI <- vals[round( (1-(alpha*0.5) ) * repli)];     
  CIs    <- c(lowCI, highCI);        
  return(CIs);         
} 
```


Table of Contents
====================================


| Information                                                   | Page |
|---------------------------------------------------------------|------|
| S1: Description of the individual-based simulation model      |  2   |
| S2: Sensitivity analysis of mortality parameters in IBM       |  4   |
| S3: Alternative derivation of male fitness threshold          |  14  |
| S4: Operational sex ratio                                     |  16  |
| S5: Estimation of key model parameter using experimental data |  17  |
| S6: Separate evolution of male search and female choice       |  18  |
| References                                                    |  19  |

\clearpage


S1: Description of the individual-based simulation model
------------------------------------

Here we describe the details of initialisation, time-in (mating), time-out (reproduction and nuptial gift search), and mortality. 
We then summarise the simulations run and data collected.

*Initialisation*

Before the first time step, a population of $N = 1000$ individuals is initialised. 
Individuals are assigned unique IDs, and each is assigned to be female with a probability of $0.5$, else male. 
Each individual $i$ is initialised with a starting value of female offspring processing time ($T^{i}_{\mathrm{f}}$), rejection probability of gift-less males ($\rho^{i}$), and male search time ($T^{i}_{\mathrm{m}}$). 
For all simulations, initialised values are set to $T^{i}_{\mathrm{f}} = 2$, $\rho^{i} = 0$, and $T^{i}_{\mathrm{m}} = 0$. 
All individuals are initalised outside of the mating pool in the first time step $t = 1$. 
The first time step then proceeds with females immediately entering the mating pool and males either entering the mating pool or searching for nuptial gifts.

*Time-in*

At the start of each time step, females and males in the mating pool remain in it. 
Females will enter the mating pool after processing offspring, and males will enter it after searching for nuptial gifts (see 'Time-out' below). 
Up to $\Psi = N\psi$ interactions between individuals can occur in a single time step, where $N$ is population size and $\psi$ is a scaling parameter. 
In each time step, $\Psi$ pairs of individuals are selected at random to interact.
For each interaction, two different individuals are randomly selected from the population with equal probability.
If the selected individuals are of different sexes, and both are in the mating pool, then a mating encounter occurs.
If the male does not have a nuptial gift, then the female will reject him with a probability of $\rho^{i}$; if rejection occurs, then both individuals stay in the mating pool. 
If rejection does not occur, or the male has a nuptial gift in the mating encounter, then the individuals mate. 
Females leave the mating pool and enter time-out to process offspring, and males leave and enter time-out to potentially search for new nuptial gifts (note that females and males might re-enter the mating pool immediately within the same time step given sufficiently low search time; see Time-out below).


*Time-out*

During time-out, offspring production and time outside of the mating pool are realised for each female by sampling from a Poisson distribution.
A focal female $i$ will produce $Poisson(\lambda)$ offspring if no nuptial gift was provided or $Poisson(\lambda + \gamma)$ if a gift was provided. 
Females remain outside of the mating pool to process offspring for $Poisson(T^{i}_{\mathrm{f}})$ time steps. 
Offspring are added to the population immediately, with $\rho^{i}$ and $T^{i}_{\mathrm{m}}$ values that are the average of each parent plus some normally distributed error $\epsilon_{R}$ and $\epsilon_{T_{\mathrm{m}}}$. 
For example,

$$T^{\mathrm{offspring}}_{\mathrm{m}} \sim \frac{T^{\mathrm{mother}}_{\mathrm{m}}  + T^{\mathrm{father}}_{\mathrm{m}}}{2} + N\left(0, \epsilon_{T_{\mathrm{m}}} \right).$$

The variation generated by $\epsilon$ values simulates mutation upon which selection for traits can act. 
In all simulations, $\epsilon = 0$ if a trait is fixed and $\epsilon = 0.01$ if the trait evolves. 
Offspring sex is randomly assigned with equal probability as female or male. 
Female offspring are immediately placed in the mating pool, and male offspring are out of the mating pool to potentially search for nuptial gifts. 
After a female has spent $T^{i}_{\mathrm{f}}$ time steps outside the mating pool, she will re-enter it.

A focal male $i$ outside the mating pool will enter it if he has searched for a fixed number of $T^{i}_{\mathrm{m}}$ time steps, which is also sampled randomly from a Poisson distribution, $Poisson(T^{i}_{\mathrm{m}})$. 
If $T^{i}_{\mathrm{m}} = 0$, then the male immediately returns to the mating pool (in the same time step). 
If $T^{i}_{\mathrm{m}} > 0$, then the male must wait outside the mating pool for $Poisson(T^{i}_{\mathrm{m}})$ time steps, but will enter the mating pool with a nuptial gift with a probability,

$$P(G^{i}) = 1 - e^{-\frac{1}{\alpha}T^{i}_{\mathrm{m}}}.$$

Males must always spend $T^{i}_{\mathrm{m}}$ time steps outside of the mating pool regardless of whether or not they are successful in obtaining a nuptial gift.

*Mortality*

At the end of each time step, mortality occurs first with a fixed probability for all adults in the population, then with a probability caused by carrying capacity $K$ applied to all individuals (adults and offspring). 
Mortality occurs in each time step with a fixed probability of $\mu$ regardless of the sex of the individual or its position in or out of the mating pool. 
If after this fixed mortality is applied, the total population size $N > K$, then individuals are removed at random with equal probability until $N = K$. 
Following adult mortality, a new time step begins with newly added offspring becoming adults.

*Simulations*

We ran simulations in which male search time and female choosiness evolved from an ancestral state of no searching and no choosiness. 
In all simulations, $N$ was initialised at 1000 and $K = 1000$. 
Simulations ran for $t_{max} = 40000$ time steps. 
We set $T_{\mathrm{f}} = 2$, $\psi = 3$, and $\lambda = 1$ for all simulations, and we simulated across a range of $\alpha = \{0.1, 0.2, ..., 1.9, 2.0\}$ and $\gamma = \{0, 0.1, ..., 1.9, 2.0\}$ parameter values for 3200 replicates. 
Summary statistics for mean trait values, population size, sex ratios, proportion of females and males in and out of the mating pool, and mean number of encounters per female and male within the mating pool were all calculated in the last time step. 
The C code used for simulating these IBMs also allows for the reporting of statistics in each time step. 
Additionally, it can simulate explicit space and individual movement through the landscape. 
A neutral evolving trait was also modelled to ensure that the code functioned as intended, and processes were compartmentalised into individual functions to facilitate code testing. 
All code is publicly available on GitHub (https://github.com/bradduthie/nuptial_gift_evolution).

A set of simulations with a value of $\gamma$ calculated from empirical data was also conducted (100 replicates). 
Here, $\gamma$ was parameterised using data on egg production as a function of eating nuptial gifts (see below). 
Additional simulation sets with lower and upper bounds of the estimated $\gamma$ were subsequently run. 
In the simulation sets with experimentally derived parameter values, all other parameters were identical to previous simulation batches.

We can produce an estimate of the fitness increment obtained by females when receiving a gift ($\hat{\gamma}$) by using data on female *P. mirabilis* egg production and hatching success under different feeding regimes from [@Tuni2013a]. 
@Tuni2013a found differences in egg production and hatching success in female *P. mirabilis* under different feeding regimes. 
Assuming these differences in feeding regimes correspond to eating versus not eating nuptial gifts, the mean number of offspring produced by a female who eats nuptial gifts can be calculated (Table 1).

\clearpage

S2: Sensitivity analysis of parameters in IBM
------------------------------------

We investigated the sensitivity of our results to individual mortality during time-in ($\mu_{\mathrm{in}}$) and time-out ($\mu_{\mathrm{out}}$), female processing time ($T_{\mathrm{f}}$), potential for interactions between conspecifics ($\psi$), and initialised male search time ($T_{\mathrm{m}}$).
Across all of these simulations, there were challenges with statistical power.
Evidence for the evolution of male search (blue points in figures) and female choosiness (red points in figures) was determined by the lower 95\% bootstrapped confidence interval of $T_{\mathrm{m}}$ and $T_{\mathrm{f}}$ values being greater than zero, respectively.
This required a lot of replicate simulations in the main text (Figure 3), especially for values just above predicted thresholds and for female choosiness.
Computation time was a limiting factor, even using a compiled language (C) and with access to a computing cluster.
Absence of points above threshold values are not necessarily evidence that evolution of male search or female choosiness is not predicted to evolve in these regions of parameter space, but it does indicate that evolution of these traits is not necessarily assured given the stochasticity inherent to the IBM.
Additional simulations can be conducted using the C code in the 'src' folder of the GitHub repository (https://github.com/bradduthie/nuptial_gift_evolution).
Below, we explain the parameter values used in the sensitivity analysis in more detail.


*Mortality*

We conducted a sensitivity analysis of the effect of the mortality parameters $\mu_{\mathrm{in}}$ and $\mu_{\mathrm{out}}$ (the probability of mortality in time-in and time-out, respectively, which we assumed to be equal for all individuals) on the evolution of male search and female choice using the IBM (See S1). 
The results revealed no correlation between the value of the mortality parameters and the evolution of male search or female choice (Fig. S2.1).

*Female processing time*

We also conducted a sensitivity analysis of female processing time $T_{\mathrm{f}}$. 
To do this, we ran simulations at default values, but with $T_{\mathrm{f}} = 0.4$ (Figure S4.2) and $T_{\mathrm{f}} = 10.0$ (Figures S4.3).

*Interactions between conspecifics*

We conducted a sensitivity analysis on the encounter rate between conspecifics ($R$) by varying the value of $\psi$ (see S1).
Under default simulations, $\psi = 3$.
We also ran simulations in which $\psi = 1$ (Figure S4.4), $\psi = 2$ (Figure S4.5), $\psi = 4$ (Figure S4.6), and $\psi = 6$ (Figure S4.7), with all other parameters being set to default values.

*Initialised male search time*

Lastly, we conducted a sensitivity analysis on initialised male search time ($T_{\mathrm{m}}$).
To do this, we ran simulations at default values, but initialised all males at $T_{\mathrm{m}} = 0.5$ (Figure S4.8) or $T_{\mathrm{m}} = 2.5$ (S4.9). 
Note that under these initialisation conditions, it no longer makes sense to test whether or not $T_{\mathrm{m}}$ evolves to positive values, so we do not show predicted male search thresholds and focus only on female choosiness.
Interestingly, while predictions given initialised $T_{\mathrm{m}} = 0.5$ are quite close for female choosiness thresholds, female choosiness does not appear to evolve given $T_{\mathrm{m}} = 2.5$.
This might be due to low selection pressure to reject males without gifts due to their low frequency.
In other words, while females would benefit from a strategy of rejecting gift-less males, a lack of realised encounters with gift-less males preclude the evolution of sustained selection for choosiness.



\clearpage


\captionsetup{labelformat=empty}

```{r echo = FALSE, fig.width = 6, fig.height = 6, fig.cap = "Figure S2.1: Evolution of both male search (blue) and female choice (red) under different combinations of the mortality rates $\\mu_{\\mathrm{in}}$ and $\\mu_{\\mathrm{out}}$ (mortality in time-in and out, respectively). The y-axis is the threshold fitness that leads to evolution of male search (blue) or female choice (red). The results show noise, but no correlation between the value of the mortality parameters and the propensity for male search and/or female choice to evolve. For each of the $25 \\times 20$ combinations of $\\mu_{\\mathrm{in}}$ and $\\mu_{\\mathrm{out}}$, 1600 replicate simulations were run."}
SUMO <- read.csv("inst/SI_mortality.csv");
mort_combn   <- paste(SUMO[,1], SUMO[,2]);
mort_label   <- unique(paste(SUMO[,1], ", ", SUMO[,2], sep = ""));
TM_vals      <- tapply(X = SUMO[,4],  INDEX = mort_combn, FUN = mean);
m_vals       <- tapply(X = SUMO[,14], INDEX = mort_combn, FUN = mean);
beta_vals    <- tapply(X = SUMO[,15], INDEX = mort_combn, FUN = mean);
Male_M       <- tapply(X = SUMO[,16], INDEX = mort_combn, FUN = mean);
Female_M     <- tapply(X = SUMO[,17], INDEX = mort_combn, FUN = mean);
Mf_nupt      <- tapply(X = SUMO[,18], INDEX = mort_combn, FUN = mean);
Mf_nonupt    <- tapply(X = SUMO[,19], INDEX = mort_combn, FUN = mean);
male_search  <- as.numeric(which(SUMO[,5] > 0 & SUMO[,6] > 0));
fem_choose   <- as.numeric(which(SUMO[,8] > 0 & SUMO[,9] > 0));
mimmom       <- unique(cbind(SUMO[,1], SUMO[,2]));

mm <- SUMO[male_search,];
mp <- NULL;
for(i in 1:dim(mm)[1]){
  rval <- which(mm[i, 1] == mimmom[,1] & mm[i, 2] == mimmom[,2]);
  mp   <- rbind(mp, c(rval, mm[i, 3]));
}

ff <- SUMO[fem_choose,];
fp <- NULL;
for(i in 1:dim(ff)[1]){
    rval <- which(ff[i, 1] == mimmom[,1] & ff[i, 2] == mimmom[,2]);
    fp   <- rbind(fp, c(rval, ff[i, 3]));
}

par(mar = c(8, 5, 1, 1));
plot(x = mp[,1], y = mp[,2], pch = 20, ylim = c(0, 2), col = "blue",
     xlab = "", ylab = "", xaxt = "n", cex.lab = 1.25);
points(x = fp[,1], y = fp[,2], cex = 2.5, col = "red", pch = 20);
points(x = mp[,1], y = mp[,2], cex = 1.5, col = "blue", pch = 20);
axis(side = 1, labels = mort_label, at = 1:25, las = 2);
mtext(text = expression(paste("Mortality combination (",mu["in"],", ", 
                              mu["out"],")")), side = 1, line = 6.5, 
      cex = 1.25); 
mtext(text = expression(paste("Fitness threshold (", gamma[f], " & ",  gamma[m], 
                              ")")), side = 2, line = 2.5, cex = 1.25); 
```

\captionsetup{labelformat=default}


\clearpage


\captionsetup{labelformat=empty}

```{r echo = FALSE, fig.width = 6, fig.height = 6, fig.cap = "Figure S2.2 ($T_{\\mathrm{f}} = 0.5$): The coevolution of male search and female choosiness as a function of nuptial gift search time ($\\alpha$). Points show where the lower 95% confidence interval of female choosiness (red) and male search (blue) exceeds zero, indicating evolution of choosiness or nuptial gift search. Each point includes data from approximately 1600 replicate simulations with identical starting conditions (some parameter combinations have fewer replicates). Red and blue lines show thresholds above which the mathematical model predicts that females should be choosy and males should search, respectively. Up to 3000 interactions occur between individuals in each time step ($\\psi = 3$), potentially resulting in a mating interaction. The number of individuals in the population remained at or near carrying capacity of $K = 1000$. Expected female processing time was set to $T_{\\mathrm{f}}=0.5$ time steps, and $\\gamma$ and $\\alpha$ values in the range [0.5, 1.5] and [0.1, 2.1], respectively, were used."}
SUMM_Tf0pt4 <- read.csv("inst/SI_Tf_0pt5.csv");

alpha_vals <- sort(unique(SUMM_Tf0pt4[,1]));
TM_vals    <- tapply(X = SUMM_Tf0pt4[,3],  INDEX = SUMM_Tf0pt4[,1], FUN = mean);
m_vals     <- tapply(X = SUMM_Tf0pt4[,13], INDEX = SUMM_Tf0pt4[,1], FUN = mean);
beta_vals  <- tapply(X = SUMM_Tf0pt4[,14], INDEX = SUMM_Tf0pt4[,1], FUN = mean);
Male_M     <- tapply(X = SUMM_Tf0pt4[,15], INDEX = SUMM_Tf0pt4[,1], FUN = mean);
Female_M   <- tapply(X = SUMM_Tf0pt4[,16], INDEX = SUMM_Tf0pt4[,1], FUN = mean);
Mf_nupt    <- tapply(X = SUMM_Tf0pt4[,17], INDEX = SUMM_Tf0pt4[,1], FUN = mean);
Mf_nonupt  <- tapply(X = SUMM_Tf0pt4[,18], INDEX = SUMM_Tf0pt4[,1], FUN = mean);

g_m  <- male_IBM_criteria(Male_M = Male_M, alpha = alpha_vals, lambda = 1);
g_f  <- female_IBM_criteria(MGf = Mf_nupt, MLf = Mf_nonupt, lambda = 1, 
                            TF = 0.5);

par(mar = c(5, 5, 1, 1)); 
plot(x = alpha_vals, y = g_f, type = "l", lwd = 2, cex.lab = 1.25, col = "red",
     xlab = expression(paste("Nuptial gift search time (", alpha, ")")),
     ylab = expression(paste("Fitness threshold (", gamma[f], " & ",  gamma[m], 
                             ")")),
     ylim = c(0, 2.1));

points(x = alpha_vals, y = g_m, type = "l", lwd = 2, col = "blue");
points(x = alpha_vals, y = g_f, type = "l", lwd = 2, col = "red", 
       lty = "dashed");

for(i in 1:dim(SUMM_Tf0pt4)[1]){
  if(SUMM_Tf0pt4[i, 4] > 0 & SUMM_Tf0pt4[i, 5] > 0){
    points(x = SUMM_Tf0pt4[i, 1], y = SUMM_Tf0pt4[i, 2], cex = 3, pch = 20, 
           col = "blue");
  }
}

for(i in 1:dim(SUMM_Tf0pt4)[1]){
  if(SUMM_Tf0pt4[i, 7] > 0 & SUMM_Tf0pt4[i, 8] > 0){
    points(x = SUMM_Tf0pt4[i, 1], y = SUMM_Tf0pt4[i, 2], cex = 2, pch = 20, 
           col = "red");
  }
}
```

\captionsetup{labelformat=default}

\clearpage

\captionsetup{labelformat=empty}

```{r echo = FALSE, fig.width = 6, fig.height = 6, fig.cap = "Figure S2.3 ($T_{\\mathrm{f}} = 10.0$): The coevolution of male search and female choosiness as a function of nuptial gift search time ($\\alpha$). Points show where the lower 95% confidence interval of female choosiness (red) and male search (blue) exceeds zero, indicating evolution of choosiness or nuptial gift search. Each point includes data from approximately 1600 replicate simulations with identical starting conditions (some parameter combinations include fewer replicates). Red and blue lines show thresholds above which the mathematical model predicts that females should be choosy and males should search, respectively. Up to 3000 interactions occur between individuals in each time step ($\\psi = 3$), potentially resulting in a mating interaction. The number of individuals in the population remained at or near carrying capacity of $K = 1000$. Expected female processing time was set to $T_{\\mathrm{f}}=10.0$ time steps, and $\\gamma$ and $\\alpha$ values in the range [0.5, 1.5] and [0.1, 2.1], respectively, were used."}
SUMM_Tf10 <- read.csv("inst/SI_Tf_10pt0.csv");

alpha_vals <- sort(unique(SUMM_Tf10[,1]));
TM_vals    <- tapply(X = SUMM_Tf10[,3],  INDEX = SUMM_Tf10[,1], FUN = mean);
m_vals     <- tapply(X = SUMM_Tf10[,13], INDEX = SUMM_Tf10[,1], FUN = mean);
beta_vals  <- tapply(X = SUMM_Tf10[,14], INDEX = SUMM_Tf10[,1], FUN = mean);
Male_M     <- tapply(X = SUMM_Tf10[,15], INDEX = SUMM_Tf10[,1], FUN = mean);
Female_M   <- tapply(X = SUMM_Tf10[,16], INDEX = SUMM_Tf10[,1], FUN = mean);
Mf_nupt    <- tapply(X = SUMM_Tf10[,17], INDEX = SUMM_Tf10[,1], FUN = mean);
Mf_nonupt  <- tapply(X = SUMM_Tf10[,18], INDEX = SUMM_Tf10[,1], FUN = mean);

g_m  <- male_IBM_criteria(Male_M = Male_M, alpha = alpha_vals, lambda = 1);
g_f  <- female_IBM_criteria(MGf = Mf_nupt, MLf = Mf_nonupt, lambda = 1, 
                            TF = 10);

par(mar = c(5, 5, 1, 1)); 
plot(x = alpha_vals, y = g_f, type = "l", lwd = 2, cex.lab = 1.25, col = "red",
     xlab = expression(paste("Nuptial gift search time (", alpha, ")")),
     ylab = expression(paste("Fitness threshold (", gamma[f], " & ",  gamma[m], 
                             ")")),
     ylim = c(0, 2.1));

points(x = alpha_vals, y = g_m, type = "l", lwd = 2, col = "blue");
points(x = alpha_vals, y = g_f, type = "l", lwd = 2, col = "red", 
       lty = "dashed");

for(i in 1:dim(SUMM_Tf10)[1]){
  if(SUMM_Tf10[i, 4] > 0 & SUMM_Tf10[i, 5] > 0){
    points(x = SUMM_Tf10[i, 1], y = SUMM_Tf10[i, 2], cex = 3, pch = 20, 
           col = "blue");
  }
}

for(i in 1:dim(SUMM_Tf10)[1]){
  if(SUMM_Tf10[i, 7] > 0 & SUMM_Tf10[i, 8] > 0){
    points(x = SUMM_Tf10[i, 1], y = SUMM_Tf10[i, 2], cex = 2, pch = 20, 
           col = "red");
  }
}
```

\captionsetup{labelformat=default}


\clearpage


\captionsetup{labelformat=empty}

```{r echo = FALSE, fig.width = 6, fig.height = 6, fig.cap = "Figure S2.4 ($\\psi = 1$): The coevolution of male search and female choosiness as a function of nuptial gift search time ($\\alpha$). Points show where the lower 95% confidence interval of where male search (blue) exceeds zero, indicating evolution of choosiness or nuptial gift search. Each point includes data from approximately 100 replicate simulations with identical starting conditions (some parameter combinations had fewer replicates, minimum 400). Red and blue lines show thresholds above which the mathematical model predicts that females should be choosy and males should search, respectively. Up to 1000 interactions occur between individuals in each time step ($\\psi = 1$), potentially resulting in a mating interaction. The number of individuals in the population remained at or near carrying capacity of $K = 1000$. Expected female processing time was set to $T_{\\mathrm{f}}=2$ time steps, and $\\gamma$ and $\\alpha$ values in the range [0.0, 1.4] and [0.1, 1.2], respectively, were used."}
SUMM_Nexp1   <- read.csv("inst/SI_Nexp_1.csv");

alpha_vals   <- sort(unique(SUMM_Nexp1[,1]));
TM_vals      <- tapply(X = SUMM_Nexp1[,3],  INDEX = SUMM_Nexp1[,1], FUN = mean);
m_vals       <- tapply(X = SUMM_Nexp1[,13], INDEX = SUMM_Nexp1[,1], FUN = mean);
beta_vals    <- tapply(X = SUMM_Nexp1[,14], INDEX = SUMM_Nexp1[,1], FUN = mean);
Male_M       <- tapply(X = SUMM_Nexp1[,15], INDEX = SUMM_Nexp1[,1], FUN = mean);
Female_M     <- tapply(X = SUMM_Nexp1[,16], INDEX = SUMM_Nexp1[,1], FUN = mean);
Mf_nupt      <- tapply(X = SUMM_Nexp1[,17], INDEX = SUMM_Nexp1[,1], FUN = mean);
Mf_nonupt    <- tapply(X = SUMM_Nexp1[,18], INDEX = SUMM_Nexp1[,1], FUN = mean);

g_m  <- male_IBM_criteria(Male_M = Male_M, alpha = alpha_vals, lambda = 1);
g_f  <- female_IBM_criteria(MGf = Mf_nupt, MLf = Mf_nonupt, lambda = 1, 
                            TF = 2);

par(mar = c(5, 5, 1, 1)); 
plot(x = alpha_vals, y = g_f, type = "l", lwd = 2, cex.lab = 1.25, col = "red",
     xlab = expression(paste("Nuptial gift search time (", alpha, ")")),
     ylab = expression(paste("Fitness threshold (", gamma[f], " & ",  gamma[m], 
                             ")")),
     ylim = c(0, 2.1));

points(x = alpha_vals, y = g_m, type = "l", lwd = 2, col = "blue");
points(x = alpha_vals, y = g_f, type = "l", lwd = 2, col = "red", 
       lty = "dashed");

for(i in 1:dim(SUMM_Nexp1)[1]){
  if(SUMM_Nexp1[i, 4] > 0 & SUMM_Nexp1[i, 5] > 0){
    points(x = SUMM_Nexp1[i, 1], y = SUMM_Nexp1[i, 2], cex = 3, pch = 20, 
           col = "blue");
  }
}

for(i in 1:dim(SUMM_Nexp1)[1]){
  if(SUMM_Nexp1[i, 7] > 0 & SUMM_Nexp1[i, 8] > 0){
    points(x = SUMM_Nexp1[i, 1], y = SUMM_Nexp1[i, 2], cex = 2, pch = 20, 
           col = "red");
  }
}
```

\captionsetup{labelformat=default}

\clearpage

\captionsetup{labelformat=empty}

```{r echo = FALSE, fig.width = 6, fig.height = 6, fig.cap = "Figure S2.5 ($\\psi = 2$): The coevolution of male search and female choosiness as a function of nuptial gift search time ($\\alpha$). Points show where the lower 95% confidence interval of where male search (blue) exceeds zero, indicating evolution of choosiness or nuptial gift search. Each point includes data from 100 replicate simulations with identical starting conditions (some parameter combinations have fewer replicates). Red and blue lines show thresholds above which the mathematical model predicts that females should be choosy and males should search, respectively. Up to 2000 interactions occur between individuals in each time step ($\\psi = 2$), potentially resulting in a mating interaction. The number of individuals in the population remained at or near carrying capacity of $K = 1000$. Expected female processing time was set to $T_{\\mathrm{f}}=2$ time steps, and $\\gamma$ and $\\alpha$ values in the range [0.0, 1.4] and [0.1, 1.2], respectively, were used."}
SUMM_Nexp2   <- read.csv("inst/SI_Nexp_2.csv");

alpha_vals   <- sort(unique(SUMM_Nexp2[,1]));
TM_vals      <- tapply(X = SUMM_Nexp2[,3],  INDEX = SUMM_Nexp2[,1], FUN = mean);
m_vals       <- tapply(X = SUMM_Nexp2[,13], INDEX = SUMM_Nexp2[,1], FUN = mean);
beta_vals    <- tapply(X = SUMM_Nexp2[,14], INDEX = SUMM_Nexp2[,1], FUN = mean);
Male_M       <- tapply(X = SUMM_Nexp2[,15], INDEX = SUMM_Nexp2[,1], FUN = mean);
Female_M     <- tapply(X = SUMM_Nexp2[,16], INDEX = SUMM_Nexp2[,1], FUN = mean);
Mf_nupt      <- tapply(X = SUMM_Nexp2[,17], INDEX = SUMM_Nexp2[,1], FUN = mean);
Mf_nonupt    <- tapply(X = SUMM_Nexp2[,18], INDEX = SUMM_Nexp2[,1], FUN = mean);

g_m  <- male_IBM_criteria(Male_M = Male_M, alpha = alpha_vals, lambda = 1);
g_f  <- female_IBM_criteria(MGf = Mf_nupt, MLf = Mf_nonupt, lambda = 1, 
                            TF = 2);

par(mar = c(5, 5, 1, 1)); 
plot(x = alpha_vals, y = g_f, type = "l", lwd = 2, cex.lab = 1.25, col = "red",
     xlab = expression(paste("Nuptial gift search time (", alpha, ")")),
     ylab = expression(paste("Fitness threshold (", gamma[f], " & ",  gamma[m], 
                             ")")),
     ylim = c(0, 2.1));

points(x = alpha_vals, y = g_m, type = "l", lwd = 2, col = "blue");
points(x = alpha_vals, y = g_f, type = "l", lwd = 2, col = "red", 
       lty = "dashed");

for(i in 1:dim(SUMM_Nexp2)[1]){
  if(SUMM_Nexp2[i, 4] > 0 & SUMM_Nexp2[i, 5] > 0){
    points(x = SUMM_Nexp2[i, 1], y = SUMM_Nexp2[i, 2], cex = 3, pch = 20, 
           col = "blue");
  }
}

for(i in 1:dim(SUMM_Nexp2)[1]){
  if(SUMM_Nexp2[i, 7] > 0 & SUMM_Nexp2[i, 8] > 0){
    points(x = SUMM_Nexp2[i, 1], y = SUMM_Nexp2[i, 2], cex = 2, pch = 20, 
           col = "red");
  }
}
```

\captionsetup{labelformat=default}


\clearpage


\captionsetup{labelformat=empty}

```{r echo = FALSE, fig.width = 6, fig.height = 6, fig.cap = "Figure S2.6 ($\\psi = 4$): The coevolution of male search and female choosiness as a function of nuptial gift search time ($\\alpha$). Points show where the lower 95% confidence interval of where male search (blue) exceeds zero, indicating evolution of choosiness or nuptial gift search. Each point includes data from 100 replicate simulations with identical starting conditions (some parameter combinations have fewer replicates). Red and blue lines show thresholds above which the mathematical model predicts that females should be choosy and males should search, respectively. Up to 4000 interactions occur between individuals in each time step, potentially resulting in a mating interaction ($\\psi = 4$). The number of individuals in the population remained at or near carrying capacity of $K = 1000$. Expected female processing time was set to $T_{\\mathrm{f}}=2$ time steps, and $\\gamma$ and $\\alpha$ values in the range [0.0, 1.4] and [0.1, 1.2], respectively, were used."}
SUMM_Nexp4   <- read.csv("inst/SI_Nexp_4.csv");

alpha_vals   <- sort(unique(SUMM_Nexp4[,1]));
TM_vals      <- tapply(X = SUMM_Nexp4[,3],  INDEX = SUMM_Nexp4[,1], FUN = mean);
m_vals       <- tapply(X = SUMM_Nexp4[,13], INDEX = SUMM_Nexp4[,1], FUN = mean);
beta_vals    <- tapply(X = SUMM_Nexp4[,14], INDEX = SUMM_Nexp4[,1], FUN = mean);
Male_M       <- tapply(X = SUMM_Nexp4[,15], INDEX = SUMM_Nexp4[,1], FUN = mean);
Female_M     <- tapply(X = SUMM_Nexp4[,16], INDEX = SUMM_Nexp4[,1], FUN = mean);
Mf_nupt      <- tapply(X = SUMM_Nexp4[,17], INDEX = SUMM_Nexp4[,1], FUN = mean);
Mf_nonupt    <- tapply(X = SUMM_Nexp4[,18], INDEX = SUMM_Nexp4[,1], FUN = mean);

g_m  <- male_IBM_criteria(Male_M = Male_M, alpha = alpha_vals, lambda = 1);
g_f  <- female_IBM_criteria(MGf = Mf_nupt, MLf = Mf_nonupt, lambda = 1, 
                            TF = 2);

par(mar = c(5, 5, 1, 1)); 
plot(x = alpha_vals, y = g_f, type = "l", lwd = 2, cex.lab = 1.25, col = "red",
     xlab = expression(paste("Nuptial gift search time (", alpha, ")")),
     ylab = expression(paste("Fitness threshold (", gamma[f], " & ",  gamma[m], 
                             ")")),
     ylim = c(0, 2.1));

points(x = alpha_vals, y = g_m, type = "l", lwd = 2, col = "blue");
points(x = alpha_vals, y = g_f, type = "l", lwd = 2, col = "red", 
       lty = "dashed");

for(i in 1:dim(SUMM_Nexp4)[1]){
  if(SUMM_Nexp4[i, 4] > 0 & SUMM_Nexp4[i, 5] > 0){
    points(x = SUMM_Nexp4[i, 1], y = SUMM_Nexp4[i, 2], cex = 3, pch = 20, 
           col = "blue");
  }
}

for(i in 1:dim(SUMM_Nexp4)[1]){
  if(SUMM_Nexp4[i, 7] > 0 & SUMM_Nexp4[i, 8] > 0){
    points(x = SUMM_Nexp4[i, 1], y = SUMM_Nexp4[i, 2], cex = 2, pch = 20, 
           col = "red");
  }
}
```

\captionsetup{labelformat=default}


\clearpage


\captionsetup{labelformat=empty}

```{r echo = FALSE, fig.width = 6, fig.height = 6, fig.cap = "Figure S2.7 ($\\psi = 6$): The coevolution of male search and female choosiness as a function of nuptial gift search time ($\\alpha$). Points show where the lower 95% confidence interval of where male search (blue) exceeds zero, indicating evolution of choosiness or nuptial gift search. Each point includes data from 100 replicate simulations with identical starting conditions (some parameter combinations have fewer replicates). Red and blue lines show thresholds above which the mathematical model predicts that females should be choosy and males should search, respectively. Up to 6000 interactions occur between individuals in each time step, potentially resulting in a mating interaction ($\\psi = 6$). The number of individuals in the population remained at or near carrying capacity of $K = 1000$. Expected female processing time was set to $T_{\\mathrm{f}}=2$ time steps, and $\\gamma$ and $\\alpha$ values in the range [0.0, 1.4] and [0.1, 1.2], respectively, were used."}
SUMM_Nexp6   <- read.csv("inst/SI_Nexp_6.csv");

alpha_vals   <- sort(unique(SUMM_Nexp6[,1]));
TM_vals      <- tapply(X = SUMM_Nexp6[,3],  INDEX = SUMM_Nexp6[,1], FUN = mean);
m_vals       <- tapply(X = SUMM_Nexp6[,13], INDEX = SUMM_Nexp6[,1], FUN = mean);
beta_vals    <- tapply(X = SUMM_Nexp6[,14], INDEX = SUMM_Nexp6[,1], FUN = mean);
Male_M       <- tapply(X = SUMM_Nexp6[,15], INDEX = SUMM_Nexp6[,1], FUN = mean);
Female_M     <- tapply(X = SUMM_Nexp6[,16], INDEX = SUMM_Nexp6[,1], FUN = mean);
Mf_nupt      <- tapply(X = SUMM_Nexp6[,17], INDEX = SUMM_Nexp6[,1], FUN = mean);
Mf_nonupt    <- tapply(X = SUMM_Nexp6[,18], INDEX = SUMM_Nexp6[,1], FUN = mean);

g_m  <- male_IBM_criteria(Male_M = Male_M, alpha = alpha_vals, lambda = 1);
g_f  <- female_IBM_criteria(MGf = Mf_nupt, MLf = Mf_nonupt, lambda = 1, 
                            TF = 2);

par(mar = c(5, 5, 1, 1)); 
plot(x = alpha_vals, y = g_f, type = "l", lwd = 2, cex.lab = 1.25, col = "red",
     xlab = expression(paste("Nuptial gift search time (", alpha, ")")),
     ylab = expression(paste("Fitness threshold (", gamma[f], " & ",  gamma[m], 
                             ")")),
     ylim = c(0, 2.1));

points(x = alpha_vals, y = g_m, type = "l", lwd = 2, col = "blue");
points(x = alpha_vals, y = g_f, type = "l", lwd = 2, col = "red", 
       lty = "dashed");

for(i in 1:dim(SUMM_Nexp6)[1]){
  if(SUMM_Nexp6[i, 4] > 0 & SUMM_Nexp6[i, 5] > 0){
    points(x = SUMM_Nexp6[i, 1], y = SUMM_Nexp6[i, 2], cex = 3, pch = 20, 
           col = "blue");
  }
}

for(i in 1:dim(SUMM_Nexp6)[1]){
  if(SUMM_Nexp6[i, 7] > 0 & SUMM_Nexp6[i, 8] > 0){
    points(x = SUMM_Nexp6[i, 1], y = SUMM_Nexp6[i, 2], cex = 2, pch = 20, 
           col = "red");
  }
}
```

\captionsetup{labelformat=default}


\clearpage


\captionsetup{labelformat=empty}

```{r echo = FALSE, fig.width = 6, fig.height = 6, fig.cap = "Figure S2.8 ($T_{\\mathrm{m}} = 0.5$): The coevolution of male search and female choosiness as a function of nuptial gift search time ($\\alpha$). Points show where the lower 95% confidence interval of where male search (blue) exceeds zero, indicating evolution of choosiness or nuptial gift search. Each point includes data from 1600 replicate simulations with identical starting conditions. The red line shows the threshold above which the mathematical model predicts that females should be choosy (male thresholds for search are not shown because simulations were initialised with males already searching for nuptial gifts). Up to 3000 interactions occur between individuals in each time step, potentially resulting in a mating interaction ($\\psi = 3$). The number of individuals in the population remained at or near carrying capacity of $K = 1000$. Expected female processing time was set to $T_{\\mathrm{f}}=2$ time steps, and $\\gamma$ and $\\alpha$ values in the range [0.0, 1.4] and [0.1, 1.2], respectively, were used."}
SUMM_Tm05   <- read.csv("inst/SI_Tm_0pt5.csv");

alpha_vals   <- sort(unique(SUMM_Tm05[,1]));
TM_vals      <- tapply(X = SUMM_Tm05[,3],  INDEX = SUMM_Tm05[,1], FUN = mean);
m_vals       <- tapply(X = SUMM_Tm05[,13], INDEX = SUMM_Tm05[,1], FUN = mean);
beta_vals    <- tapply(X = SUMM_Tm05[,14], INDEX = SUMM_Tm05[,1], FUN = mean);
Male_M       <- tapply(X = SUMM_Tm05[,15], INDEX = SUMM_Tm05[,1], FUN = mean);
Female_M     <- tapply(X = SUMM_Tm05[,16], INDEX = SUMM_Tm05[,1], FUN = mean);
Mf_nupt      <- tapply(X = SUMM_Tm05[,17], INDEX = SUMM_Tm05[,1], FUN = mean);
Mf_nonupt    <- tapply(X = SUMM_Tm05[,18], INDEX = SUMM_Tm05[,1], FUN = mean);

g_m  <- male_IBM_criteria(Male_M = Male_M, alpha = alpha_vals, lambda = 1);
g_f  <- female_IBM_criteria(MGf = Mf_nupt, MLf = Mf_nonupt, lambda = 1, 
                            TF = 2);

par(mar = c(5, 5, 1, 1)); 
plot(x = alpha_vals, y = g_f, type = "l", lwd = 2, cex.lab = 1.25, col = "red",
     xlab = expression(paste("Nuptial gift search time (", alpha, ")")),
     ylab = expression(paste("Fitness threshold (", gamma[f], " & ",  gamma[m], 
                             ")")),
     ylim = c(0, 1.6));

points(x = alpha_vals, y = g_f, type = "l", lwd = 2, col = "red", 
       lty = "dashed");

for(i in 1:dim(SUMM_Tm05)[1]){
  if(SUMM_Tm05[i, 4] > 0 & SUMM_Tm05[i, 5] > 0){
    points(x = SUMM_Tm05[i, 1], y = SUMM_Tm05[i, 2], cex = 3, pch = 20, 
           col = "blue");
  }
}

for(i in 1:dim(SUMM_Tm05)[1]){
  if(SUMM_Tm05[i, 7] > 0 & SUMM_Tm05[i, 8] > 0){
    points(x = SUMM_Tm05[i, 1], y = SUMM_Tm05[i, 2], cex = 2, pch = 20, 
           col = "red");
  }
}
```

\captionsetup{labelformat=default}


\clearpage


\captionsetup{labelformat=empty}

```{r echo = FALSE, fig.width = 6, fig.height = 6, fig.cap = "Figure S2.9 ($T_{\\mathrm{m}} = 2.5$): The coevolution of male search and female choosiness as a function of nuptial gift search time ($\\alpha$). Points show where the lower 95% confidence interval of where male search (blue) exceeds zero, indicating evolution of choosiness or nuptial gift search. Each point includes data from 1600 replicate simulations with identical starting conditions. The red line shows the threshold above which the mathematical model predicts that females should be choosy (male thresholds for search are not shown because simulations were initialised with males already searching for nuptial gifts). Up to 3000 interactions occur between individuals in each time step, potentially resulting in a mating interaction ($\\psi = 3$). The number of individuals in the population remained at or near carrying capacity of $K = 1000$. Expected female processing time was set to $T_{\\mathrm{f}}=2$ time steps, and $\\gamma$ and $\\alpha$ values in the range [0.0, 1.4] and [0.1, 1.2], respectively, were used."}
SUMM_Tm2p5   <- read.csv("inst/SI_Tm_2pt5.csv");

alpha_vals   <- sort(unique(SUMM_Tm2p5[,1]));
TM_vals      <- tapply(X = SUMM_Tm2p5[,3],  INDEX = SUMM_Tm2p5[,1], FUN = mean);
m_vals       <- tapply(X = SUMM_Tm2p5[,13], INDEX = SUMM_Tm2p5[,1], FUN = mean);
beta_vals    <- tapply(X = SUMM_Tm2p5[,14], INDEX = SUMM_Tm2p5[,1], FUN = mean);
Male_M       <- tapply(X = SUMM_Tm2p5[,15], INDEX = SUMM_Tm2p5[,1], FUN = mean);
Female_M     <- tapply(X = SUMM_Tm2p5[,16], INDEX = SUMM_Tm2p5[,1], FUN = mean);
Mf_nupt      <- tapply(X = SUMM_Tm2p5[,17], INDEX = SUMM_Tm2p5[,1], FUN = mean);
Mf_nonupt    <- tapply(X = SUMM_Tm2p5[,18], INDEX = SUMM_Tm2p5[,1], FUN = mean);

g_m  <- male_IBM_criteria(Male_M = Male_M, alpha = alpha_vals, lambda = 1);
g_f  <- female_IBM_criteria(MGf = Mf_nupt, MLf = Mf_nonupt, lambda = 1, 
                            TF = 2);

par(mar = c(5, 5, 1, 1)); 
plot(x = alpha_vals, y = g_f, type = "l", lwd = 2, cex.lab = 1.25, col = "red",
     xlab = expression(paste("Nuptial gift search time (", alpha, ")")),
     ylab = expression(paste("Fitness threshold (", gamma[f], " & ",  gamma[m], 
                             ")")),
     ylim = c(0, 1.6));

points(x = alpha_vals, y = g_f, type = "l", lwd = 2, col = "red", 
       lty = "dashed");

for(i in 1:dim(SUMM_Tm2p5)[1]){
  if(SUMM_Tm2p5[i, 4] > 0 & SUMM_Tm2p5[i, 5] > 0){
    points(x = SUMM_Tm2p5[i, 1], y = SUMM_Tm2p5[i, 2], cex = 3, pch = 20, 
           col = "blue");
  }
}

for(i in 1:dim(SUMM_Tm2p5)[1]){
  if(SUMM_Tm2p5[i, 7] > 0 & SUMM_Tm2p5[i, 8] > 0){
    points(x = SUMM_Tm2p5[i, 1], y = SUMM_Tm2p5[i, 2], cex = 2, pch = 20, 
           col = "red");
  }
}
```

\captionsetup{labelformat=default}


\clearpage



S3: Alternative derivation of male fitness threshold
------------------------------------

In the main text, we assumed that males made the decision to search or not search for a nuptial gift.
The expected length of time for which searching males are expected to remain outside of the mating pool is $E[T_{\mathrm{m}}] = \alpha$ (see Methods).
Alternatively, we can assume that males search for a period of $T_{\mathrm{m}}$ and spend this full duration of $T_{\mathrm{m}}$ in the time-out phase, even if they succeed in finding a nuptial gift.
The probability that a male obtains a nuptial gift during this time is modelled in Eq. 1, 

$$P(G) = 1 - e^{-\frac{1}{\alpha}T_{\mathrm{m}}}.$$

In Eq. 1, $\alpha$ is the amount of time expected to pass before a male encounters a nuptial gift. 
We assume that a male will only enter the mating pool with no gift if they are unsuccessful in obtaining a gift, so the probability that a male obtains no gift after $T_{\mathrm{m}}$ is,

$$P(L) = e^{-\frac{1}{\alpha}T_{\mathrm{m}}}.$$

We assume that the fitness increments to offspring associated with receiving a nuptial gift versus no nuptial gift are $1 + \gamma$ and 1, respectively. 
The rate at which males increase their fitness can then be defined as the expected fitness increment from their nuptial gift search divided by $T_{\mathrm{m}}$ plus the time spent in the mating pool waiting to encounter a mate, 

$$W_{\mathrm{m}} = \lambda \frac{P(G)\left(1 + \gamma\right) + P(L)}{T_{\mathrm{m}} + \left( \frac{\beta + 1}{R} \right)}.$$

Our objective now is to determine the conditions under which a focal male increases its fitness by searching for a nuptial gift ($T_{\mathrm{m}}>0$) in a population of resident males that do not search ($T_{\mathrm{m}}=0$). 
Females are assumed to exhibit no choice in males with versus without nuptial gifts. Under such conditions, male fitness cannot be affected by female choice, so selection to increase $T_{\mathrm{m}}>0$ must be based solely on $\alpha$, $\beta$, $R$, and $\gamma$.

To determine under what conditions male inclusive fitness increases with nuptial gift search time, we can differentiate $W_{\mathrm{m}}$ with respect to $T_{\mathrm{m}}$,


$$\frac{\partial W_{\mathrm{m}}}{\partial T_{\mathrm{m}}} = \lambda\frac{\gamma\left(\frac{\frac{T_{\mathrm{m}} + \frac{\beta + 1}{R}}{\alpha} + 1}{e^{\frac{1}{\alpha}T_{\mathrm{m}}}} - 1\right) - 1}{\left(T_{\mathrm{m}} + \frac{\beta + 1}{R} \right)^{2}}.$$

Because $T_{\mathrm{m}} = 0$, the above simplifies,

$$\frac{\partial W_{\mathrm{m}}}{\partial T_{\mathrm{m}}} = \lambda \frac{\frac{R\gamma\left(\beta + 1\right)}{\alpha} - R^{2}}{\left(1 + \beta \right)^{2}}.$$

We can re-arrange the above,

$$\frac{\partial W_{\mathrm{m}}}{\partial T_{\mathrm{m}}} = \lambda \frac{R\gamma}{\alpha\left(\beta+1\right)} - \lambda\frac{R^{2}}{{\left(1 + \beta \right)^{2}}}.$$


Note that if $R = 0$ or $\lambda = 0$, then, trivially, no change in fitness occurs (since females and males cannot mate or do not produce offspring). 
Fitness is increased by searching for nuptial gifts when $\gamma$ is high, scaled by the expect search time needed to find a nuptial gift. 
A second term on the right-hand side is subtracted, which reflects a loss in fitness proportional to the encounter rate of potential mates in the mating pool.
The conditions under which male inclusive fitness increases by searching for a nuptial gift are found by setting $\partial W_{\mathrm{m}}/\partial T_{\mathrm{m}} = 0$ and solving for $\gamma$ to get Eq. 2 in the main text.

\clearpage


S4: Operational sex ratio
------------------------------------

We assume that the ratio of males to females is the same upon individual maturation.
Consequently, the operational sex ratio $\beta$ will be a function of $R$, $T_{\mathrm{f}}$, and $T_{\mathrm{m}}$ because these parameters determine the density of females and males in the mating pool versus outside of the mating pool.
We start with the definition of $\beta$ as being the probability of finding an individual in time-in [@Kokko2001],

$$\beta = \frac{\int_{t=0}^{\infty}P_{IM}(t)dt}{\int_{t=0}^{\infty}P_{IF}(t)dt}$$

We can substitute the equations for $P_{IM}(t)$ and $P_{IF}(t)$, which define the probabilities of males and females being within the mating pool at time $t$, respectively.

We can therefore calculate $\beta$ as below,

$$\beta = \frac{\left( \frac{\left(\frac{\beta + 1}{R}\right)}{T_{\mathrm{m}} + \left(\frac{\beta + 1}{R}\right)} \right)}{\left( \frac{\left(R \frac{\beta}{\beta + 1}\right)}{T_{\mathrm{f}} + \left(R \frac{\beta}{\beta + 1}\right)} \right)}.$$

This can be simplified,

$$\beta = \frac{\left(\beta\left(R + T_{f}\right) + T_{f}\right)\left(\beta + 1\right)}{\beta \left(R^{2}T_{m} + R\right) + \beta^{2}R}.$$

There is no closed form solution for $\beta$, but a recursive algorithm can be used to calculate $\beta$ to an arbitrary degree of precision.

```{r}
recursive_b <- function(B, D, Tf, Tm, crit = 0.0001, maxit = 9999){
  conv <- 1;
  iter <- 0;
  while(conv > crit & iter < maxit){
    Fe   <- D * (B / (1 + B));
    Me   <- (1 + B) / D;
    Bn   <- (Me / (Tm + Me)) / (Fe / (Tf + Fe));
    iter <- iter + 1;
    conv <- abs(Bn - B);
    B    <- Bn;
  }
  return(list(B = B, conv = conv, iter = iter));
}
```

We used the above function to calculate values of $\beta$ for the analytical model. 


\clearpage

S5: Estimation of key model parameters using experimental data
-------------------------------------

Estimates showing the mean number of offspring produced by female *Pisaura mirabilis* that ate nuptial gifts and females who did not. 
Means were calculated with raw data from @Tuni2013a and results are shown $\pm$ SE (Table 1).
Under these assumptions, the relative gain in fitness from receiving nuptial gifts for a female is,

$$\hat{\delta_\mathrm{f}} = \frac{25.74}{6.00} = 4.29$$

Since the baseline fitness is 1, the increase in fitness resulting from a nuptial gift then becomes,

$$\hat{\gamma} = \hat{\delta_{\mathrm{f}}} - 1 = 3.29.$$

The value 3.29 was used to parameterise $\gamma$ for a set of simulations (Figure 4 in the main text).

|                                 | Received nuptial gift | Received no nuptial gift |
|---------------------------------|-----------------------|--------------------------|
| Expected number of hatched eggs | $25.74 \pm 0.96$      | $6.00 \pm 2.1$           |

Table 1: Estimates showing mean number of offspring produced by female *P. mirabilis* that ate nuptial gifts and females who did not. Means were calculated with raw data from @Tuni2013a and results are shown $\pm$ SE.


\clearpage


S6: Separate evolution of male search and female choice
-------------------------------------

We used the individual-based simulation model (see Supporting Information S1) to unpack the effect of coevolution on the evolution of male search and female choice. 
Here we replicated the simulations shown in the main text under the condition where only one trait at a time was allowed to evolve and studied how this affected the trait evolution. 

First, we submitted a set of simulations wherein male search did not evolve, but was fixed at different values (see Fig. S6.1). 
Next, we ran the same set of simulations wherein male search evolved, but female choice was not possible. 
The results thus show how each trait evolves in the absence of any coevolution (Fig. S6.1). 

\captionsetup{labelformat=empty}

```{r echo = FALSE, fig.width = 6, fig.height = 6, fig.cap = "Figure S6.1: The separate evolution of male search and female choosiness as a function of nuptial gift search time. Points show where the lower 95% confidence interval of male search (blue) and female choosiness (red) exceeds zero, indicating evolution of nuptial gift search or choosiness. Each point includes data from $2 \\times 1600$ replicate simulations with identical starting conditions. In the first batch, male search was constant and initialized at $T_{\\mathrm{m}} = \\alpha$, and female choice was evolving. In the second batch, male search was evolving, and there was no option for female choice. The parameters $T_{\\mathrm{f}}=2$, and $\\gamma$ and $\\alpha$ values were set within the range [0.1, 2.0] and [0.3, 1.7], respectively."}
SUMM_m <- read.csv("inst/summary_male_evolving.csv");
SUMM_f <- read.csv("inst/summary_female_evolving.csv");
# Males
TM_vals      <- tapply(X = SUMM_m[,3],  INDEX = SUMM_m[,1], FUN = mean);
m_vals       <- tapply(X = SUMM_m[,13], INDEX = SUMM_m[,1], FUN = mean);
beta_vals    <- tapply(X = SUMM_m[,14], INDEX = SUMM_m[,1], FUN = mean);
Male_M       <- tapply(X = SUMM_m[,15], INDEX = SUMM_m[,1], FUN = mean);
Female_M     <- tapply(X = SUMM_m[,16], INDEX = SUMM_m[,1], FUN = mean);
Mf_nupt      <- tapply(X = SUMM_m[,17], INDEX = SUMM_m[,1], FUN = mean);
Mf_nonupt    <- tapply(X = SUMM_m[,18], INDEX = SUMM_m[,1], FUN = mean);
alpha_vals   <- sort(unique(SUMM_m[,1]));

g_m <- male_IBM_criteria(Male_M = Male_M, alpha = alpha_vals, lambda = 1);

# Females 
TM_vals      <- tapply(X = SUMM_f[,3],  INDEX = SUMM_f[,1], FUN = mean);
m_vals       <- tapply(X = SUMM_f[,13], INDEX = SUMM_f[,1], FUN = mean);
beta_vals    <- tapply(X = SUMM_f[,14], INDEX = SUMM_f[,1], FUN = mean);
Male_M       <- tapply(X = SUMM_f[,15], INDEX = SUMM_f[,1], FUN = mean);
Female_M     <- tapply(X = SUMM_f[,16], INDEX = SUMM_f[,1], FUN = mean);
Mf_nupt      <- tapply(X = SUMM_f[,17], INDEX = SUMM_f[,1], FUN = mean);
Mf_nonupt    <- tapply(X = SUMM_f[,18], INDEX = SUMM_f[,1], FUN = mean);
alpha_vals   <- sort(unique(SUMM_f[,1]));

g_f <- female_IBM_criteria(MGf = Mf_nupt, MLf = Mf_nonupt, lambda = 1, TF = 2);

par(mar = c(5, 5, 1, 1)); 
plot(x = alpha_vals, y = g_m, type = "l", lwd = 2, cex.lab = 1.25,
     xlab = expression(paste("Nuptial gift search time (", alpha, ")")),
     ylab = expression(paste("Fitness threshold (", gamma[f], " & ",  gamma[m], 
                             ")")),
     ylim = c(0, 2), col = "blue");

for(i in 1:dim(SUMM_m)[1]){
  if(SUMM_m[i, 4] > 0 & SUMM_m[i, 5] > 0){
    points(x = SUMM_m[i, 1], y = SUMM_m[i, 2], cex = 3, pch = 20, col = "blue");
  }
}

points(x = alpha_vals, y = g_f, type = "l", lwd = 2, col = "red");

for(i in 1:dim(SUMM_f)[1]){
  if(SUMM_f[i, 7] > 0 & SUMM_f[i, 8] > 0){
    points(x = SUMM_f[i, 1], y = SUMM_f[i, 2], cex = 2, pch = 20, col = "red");
  }
}
```

\captionsetup{labelformat=default}

\clearpage

References
=============================================




